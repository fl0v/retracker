
services:
  retracker:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    container_name: retracker
    ports:
      - "6969:6969"      # HTTP port
      - "6969:6969/udp"  # UDP port
    volumes:
      # Mount main config and forwarders files from host
      - ../configs/config.yml:/app/configs/config.yml
      - ../configs/forwarders.yml:/app/configs/forwarders.yml
      # Tracker source lists used by scripts/update-forwarders.sh
      - ../configs/trackers-lists.txt:/app/configs/trackers-lists.txt
      - ../configs/trackers.txt:/app/configs/trackers.txt
    environment:
      # Configuration file path
      - RETRACKER_CONFIG=/app/configs/config.yml
      # HTTP listen address:port (overrides config file)
      - RETRACKER_LISTEN=:6969
      # UDP listen address:port (empty to disable)
      - RETRACKER_UDP_LISTEN=:6969
      # Load forwards from YAML file
      - RETRACKER_FORWARDS=/app/configs/forwarders.yml
      # Optionally refresh forwarders list on startup (runs /app/scripts/update-forwarders.sh)
      # - RETRACKER_UPDATE_FORWARDERS=true
      #
      # Tracker sources consumed by scripts/update-forwarders.sh
      # Defaults in the script are configs/trackers-lists.txt and configs/trackers.txt;
      # we set explicit container paths here for clarity.
      - TRACKER_LISTS_FILE=/app/configs/trackers-lists.txt
      - ADDITIONAL_TRACKERS_FILE=/app/configs/trackers.txt
      # Debug mode (default: false)
      - RETRACKER_DEBUG=false
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:6969/favicon.ico"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
